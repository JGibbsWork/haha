# Presence-Based Lighting Automations
# Automatic lights based on room occupancy

- id: kitchen_lights_on_presence
  alias: "Kitchen Lights: Turn On When Occupied"
  description: Turn on kitchen track lights when person enters kitchen
  mode: single
  triggers:
    - platform: state
      entity_id: input_boolean.kitchen_occupied
      to: 'on'
  conditions:
    - condition: state
      entity_id: input_boolean.kitchen_manual_override
      state: 'off'
  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_track_1
          - light.kitchen_track_2
      data: {}

- id: kitchen_lights_off_presence
  alias: "Kitchen Lights: Turn Off When Empty"
  description: Turn off kitchen track lights when person leaves kitchen
  mode: restart
  triggers:
    - platform: state
      entity_id: input_boolean.kitchen_occupied
      to: 'off'
      for:
        seconds: 15
  conditions:
    - condition: state
      entity_id: input_boolean.kitchen_manual_override
      state: 'off'
  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_track_1
          - light.kitchen_track_2
      data: {}

- id: kitchen_lights_manual_override_on
  alias: "Kitchen Lights: Manual Override ON"
  description: Turn on kitchen lights when manual override is enabled
  mode: single
  triggers:
    - platform: state
      entity_id: input_boolean.kitchen_manual_override
      to: 'on'
  conditions: []
  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_track_1
          - light.kitchen_track_2
      data: {}

- id: kitchen_lights_manual_override_off
  alias: "Kitchen Lights: Manual Override OFF"
  description: Turn off kitchen lights when manual override is disabled
  mode: single
  triggers:
    - platform: state
      entity_id: input_boolean.kitchen_manual_override
      to: 'off'
  conditions: []
  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_track_1
          - light.kitchen_track_2
      data: {}

# Failsafe: Force lights off after max time
- id: kitchen_lights_failsafe_timeout
  alias: "Kitchen Lights: Failsafe Timeout"
  description: Turn off kitchen lights if occupied for more than 15 minutes (Frigate detection failsafe)
  mode: restart
  triggers:
    - platform: state
      entity_id: input_boolean.kitchen_occupied
      to: 'on'
      for:
        minutes: 15
  conditions:
    - condition: state
      entity_id: input_boolean.kitchen_manual_override
      state: 'off'
  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_track_1
          - light.kitchen_track_2
      data: {}
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.kitchen_occupied
